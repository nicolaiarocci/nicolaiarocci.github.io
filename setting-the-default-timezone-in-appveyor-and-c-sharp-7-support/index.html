<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Setting the default timezone in AppVeyor build worker (and C# 7.0 support) | Nicola Iarocci</title>
<meta name=keywords content=".net,appveyor"><meta name=description content="So yesterday I pushed some code over to GitHub, then went off to work on a different project. A few seconds later I got an email from AppVeyor telling me that my CI build worker was reporting a failure. I was surprised as just ahead of the push I had tests all green in local.
Turned out failure was on an equality assertion between two date values:
As you can see the mismatch was precisely two hours."><meta name=author content><link rel=canonical href=https://nicolaiarocci.com/setting-the-default-timezone-in-appveyor-and-c-sharp-7-support/><link crossorigin=anonymous href=/assets/css/stylesheet.2d50b1531bd1b3146d65c5543bd298f7f982786aadee4c223cb3a1cb51906106.css integrity="sha256-LVCxUxvRsxRtZcVUO9KY9/mCeGqt7kwiPLOhy1GQYQY=" rel="preload stylesheet" as=style><link rel=icon href=https://nicolaiarocci.com/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://nicolaiarocci.com/images/favicon16x16.ico><link rel=icon type=image/png sizes=32x32 href=https://nicolaiarocci.com/images/favicon32x32.ico><link rel=apple-touch-icon href=https://nicolaiarocci.com/images/favicon.ico><link rel=mask-icon href=https://nicolaiarocci.com/images/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Setting the default timezone in AppVeyor build worker (and C# 7.0 support)"><meta property="og:description" content="So yesterday I pushed some code over to GitHub, then went off to work on a different project. A few seconds later I got an email from AppVeyor telling me that my CI build worker was reporting a failure. I was surprised as just ahead of the push I had tests all green in local.
Turned out failure was on an equality assertion between two date values:
As you can see the mismatch was precisely two hours."><meta property="og:type" content="article"><meta property="og:url" content="https://nicolaiarocci.com/setting-the-default-timezone-in-appveyor-and-c-sharp-7-support/"><meta property="og:image" content="https://nicolaiarocci.com/images/avatar.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2017-02-25T16:48:09+01:00"><meta property="article:modified_time" content="2017-02-25T16:48:09+01:00"><meta property="og:site_name" content="Nicola Iarocci"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nicolaiarocci.com/images/avatar.png"><meta name=twitter:title content="Setting the default timezone in AppVeyor build worker (and C# 7.0 support)"><meta name=twitter:description content="So yesterday I pushed some code over to GitHub, then went off to work on a different project. A few seconds later I got an email from AppVeyor telling me that my CI build worker was reporting a failure. I was surprised as just ahead of the push I had tests all green in local.
Turned out failure was on an equality assertion between two date values:
As you can see the mismatch was precisely two hours."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://nicolaiarocci.com/post/"},{"@type":"ListItem","position":3,"name":"Setting the default timezone in AppVeyor build worker (and C# 7.0 support)","item":"https://nicolaiarocci.com/setting-the-default-timezone-in-appveyor-and-c-sharp-7-support/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Setting the default timezone in AppVeyor build worker (and C# 7.0 support)","name":"Setting the default timezone in AppVeyor build worker (and C# 7.0 support)","description":"So yesterday I pushed some code over to GitHub, then went off to work on a different project. A few seconds later I got an email from AppVeyor telling me that my CI build worker was reporting a failure. I was surprised as just ahead of the push I had tests all green in local.\nTurned out failure was on an equality assertion between two date values:\nAs you can see the mismatch was precisely two hours.","keywords":[".net","appveyor"],"articleBody":"So yesterday I pushed some code over to GitHub, then went off to work on a different project. A few seconds later I got an email from AppVeyor telling me that my CI build worker was reporting a failure. I was surprised as just ahead of the push I had tests all green in local.\nTurned out failure was on an equality assertion between two date values:\nAs you can see the mismatch was precisely two hours. That always rings a Time Zone alarm bell in my head. I was under the assumption that since my time zone was correctly set in my account settings, the workers would pick it up. Well as it turns out, that is not the case as that setting is only used for notifications and NuGet feeds. The AppVeyor app worker runs on UTC by default.\nSolution was straightforward. I edited the appveyor.yml file and instructed the worker to launch tzutil and set the desired time zone immediately, before anything else is executed:\nAnd that was it. Remember, you can use tzutil /l on your local box to get a list of the available timezones.\nAnother minor (and temporary) issue I have with AppVeyor is that they do not officially support C# 7.0 yet. Try using an inline temporary variable in your code. Tests will be green in local and happily fail on AppVeyor, as the VM runs MSBuild 14. The Visual Studio 2017 RC image is in beta and not available in the Environment settings unless you explictly ask for it here. They are quick to reply though and then, not without some more fiddling (see the post at the top of the thread), you can get C# 7.0 features to run seamlessly in the VM.\nJoin the newsletter to get an email alert when a new post surfaces on this site. If you want to get in touch, I am @nicolaiarocci on twitter.\n","wordCount":"320","inLanguage":"en","datePublished":"2017-02-25T16:48:09+01:00","dateModified":"2017-02-25T16:48:09+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://nicolaiarocci.com/setting-the-default-timezone-in-appveyor-and-c-sharp-7-support/"},"publisher":{"@type":"Organization","name":"Nicola Iarocci","logo":{"@type":"ImageObject","url":"https://nicolaiarocci.com/images/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://nicolaiarocci.com accesskey=h title="Home (Alt + H)"><img src=https://nicolaiarocci.com/images/avatar.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://nicolaiarocci.com/opensource/ title=code><span>code</span></a></li><li><a href=https://nicolaiarocci.com/speaking/ title=speaking><span>speaking</span></a></li><li><a href=https://nicolaiarocci.com/books-i-have-read/ title=library><span>library</span></a></li><li><a href=https://buttondown.email/nicolaiarocci title=newsletter><span>newsletter</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://nicolaiarocci.com/index.xml title=rss><span>rss</span></a></li><li><a href=https://nicolaiarocci.com/archives/ title=archive><span>archive</span></a></li><li><a href=https://nicolaiarocci.com/tags/ title=tags><span>tags</span></a></li><li><a href=https://nicolaiarocci.com/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Setting the default timezone in AppVeyor build worker (and C# 7.0 support)</h1><div class=post-meta><span title='2017-02-25 16:48:09 +0100 CET'>February 25, 2017</span></div></header><div class=post-content><p>So yesterday I pushed some code over to GitHub, then went off to work on
a different project. A few seconds later I got an email from <a href=https://www.appveyor.com>AppVeyor</a>
telling me that my CI build worker was reporting a failure. I was surprised as
just ahead of the push I had tests all green in local.</p><p>Turned out failure was on an equality assertion between two date values:</p><p><img loading=lazy src=/images/appveyor-failure-on-date-fields.png alt></p><p>As you can see the mismatch was <em>precisely</em> two hours. That always rings a Time
Zone alarm bell in my head. I was under the assumption that since my time zone
was correctly set in my account settings, the workers would pick it up. Well as
it turns out, that is not the case as that setting is only used for
notifications and NuGet feeds. The AppVeyor app worker runs on UTC by default.</p><p>Solution was straightforward. I edited the <code>appveyor.yml</code> file and instructed
the worker to launch <code>tzutil</code> and set the desired time zone immediately, before
anything else is executed:</p><script src=https://gist.github.com/nicolaiarocci/afbce25a393067e3e22e2f3f706f548a.js></script><p>And that was it. Remember, you can use <code>tzutil /l</code> on your local box to get
a list of the available timezones.</p><p>Another minor (and temporary) issue I have with AppVeyor is that they do not
officially support C# 7.0 yet. Try using an inline temporary variable in your
code. Tests will be green in local and happily fail on AppVeyor, as the VM runs
MSBuild 14. The Visual Studio 2017 RC image is in beta and not available in the
Environment settings unless you explictly ask for it <a href=https://github.com/appveyor/ci/issues/1179>here</a>. They are quick
to reply though and then, not without some more fiddling (see the post at the
top of the thread), you can get C# 7.0 features to run seamlessly in the VM.</p><p><em>Join the <a href=http://eepurl.com/b-_Pzz>newsletter</a> to get an email alert when a new post surfaces on
this site. If you want to get in touch, I am @<a href=http://twitter.com/nicolaiarocci>nicolaiarocci</a> on twitter.</em></p><i>Subscribe to my <a href=https://buttondown.email/nicolaiarocci>newsletter</a> or the <a href=/index.xml>RSS
feed</a>. Follow me on <a href=https://fosstodon.org/@nicola>Mastodon</a> or <a href=https://twitter.com/nicolaiarocci>X</a>.</div><footer class=post-footer><ul class=post-tags><li><a href=https://nicolaiarocci.com/tags/.net/>.net</a></li><li><a href=https://nicolaiarocci.com/tags/appveyor/>appveyor</a></li></ul></footer></article></main><footer class=footer><span>Produced / Written / Maintained by <a href=/>Nicola Iarocci</a> since 2010</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>