<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to remove a file from Git history | Nicola Iarocci</title>
<meta name=keywords content="til,git,tools"><meta name=description content="Today I learned how to remove a file from a git repository while also cleaning
it from the history. When you delete it with git rm or git rm --cached,
tracks remain in the commit history (the reflog). That might not be a big deal,
but if the file has sensitive contents that you want to disappear from version
control entirely, then you also want it cleaned from the reflog. That&rsquo;s when
git filter-branch comes to the rescue."><meta name=author content><link rel=canonical href=https://nicolaiarocci.com/how-to-remove-a-file-from-git-history/><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://nicolaiarocci.com/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://nicolaiarocci.com/images/favicon16x16.ico><link rel=icon type=image/png sizes=32x32 href=https://nicolaiarocci.com/images/favicon32x32.ico><link rel=apple-touch-icon href=https://nicolaiarocci.com/images/favicon.ico><link rel=mask-icon href=https://nicolaiarocci.com/images/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://nicolaiarocci.com/how-to-remove-a-file-from-git-history/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://nicolaiarocci.com/how-to-remove-a-file-from-git-history/"><meta property="og:site_name" content="Nicola Iarocci"><meta property="og:title" content="How to remove a file from Git history"><meta property="og:description" content="Today I learned how to remove a file from a git repository while also cleaning it from the history. When you delete it with git rm or git rm --cached, tracks remain in the commit history (the reflog). That might not be a big deal, but if the file has sensitive contents that you want to disappear from version control entirely, then you also want it cleaned from the reflog. That’s when git filter-branch comes to the rescue."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-07-30T07:05:25+01:00"><meta property="article:modified_time" content="2021-07-30T07:05:25+01:00"><meta property="article:tag" content="Til"><meta property="article:tag" content="Git"><meta property="article:tag" content="Tools"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to remove a file from Git history"><meta name=twitter:description content="Today I learned how to remove a file from a git repository while also cleaning
it from the history. When you delete it with git rm or git rm --cached,
tracks remain in the commit history (the reflog). That might not be a big deal,
but if the file has sensitive contents that you want to disappear from version
control entirely, then you also want it cleaned from the reflog. That&rsquo;s when
git filter-branch comes to the rescue."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://nicolaiarocci.com/post/"},{"@type":"ListItem","position":2,"name":"How to remove a file from Git history","item":"https://nicolaiarocci.com/how-to-remove-a-file-from-git-history/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to remove a file from Git history","name":"How to remove a file from Git history","description":"Today I learned how to remove a file from a git repository while also cleaning it from the history. When you delete it with git rm or git rm --cached, tracks remain in the commit history (the reflog). That might not be a big deal, but if the file has sensitive contents that you want to disappear from version control entirely, then you also want it cleaned from the reflog. That\u0026rsquo;s when git filter-branch comes to the rescue.\n","keywords":["til","git","tools"],"articleBody":"Today I learned how to remove a file from a git repository while also cleaning it from the history. When you delete it with git rm or git rm --cached, tracks remain in the commit history (the reflog). That might not be a big deal, but if the file has sensitive contents that you want to disappear from version control entirely, then you also want it cleaned from the reflog. That’s when git filter-branch comes to the rescue.\nTo be on the safe side, I first cloned the repository to a test directory:\n$ git clone test $ cd test Once into the test directory, this is the command that saved the day:\n# make sure you insert the whole file path, relative to the repository root $ git filter-branch --force --index-filter \\ \"git rm --cached --ignore-unmatch PATH-TO-THE-FILE\" \\ --prune-empty --tag-name-filter cat -- --all The command above will go through the history, find all commits where the file is involved, and alter them to eliminate the file. Yes, history changes, so a force-push will be required at the end.\nTo test that the file has indeed been removed, I used git blame:\n$ git blame PATH-TO-THE-FILE fatal: no such path 'PATH-TO-THE-FILE' in HEAD If the file needs to stay in the local directory, you can add it to .gitignore:\n$ echo \"PATH-TO-THE-FILE\" \u003e\u003e .gitignore $ git add .gitignore $ git commit -m \"add FILE to .gitignore\" Once everything was ready, I went back to the original clone directory, replayed all the above, then force-pushed back to the remote:\n$ git push origin --force --all If you have remote tags, those need to be force-pushed as well:\n$ git push origin --force --tags In my case, the repository is private with no forks, so the changing history was not a big deal for the few colleagues with access to it. Of course, any other existing clone will need to be updated1.\nIn so many years with git, this is the very first time I had to do something similar. Typically, you don’t commit sensitive data to version control, but we all make mistakes every once in a while, don’t we?\nKeep in mind, eventual stashed changes will be lost after git filter-branch. Make sure you unstash before issuing the command. [rss]: https://nicolaiarocci.com/index.xml [tw]: http://twitter.com/nicolaiarocci [nl]: https://buttondown.email/nicolaiarocci ↩︎\n","wordCount":"386","inLanguage":"en","datePublished":"2021-07-30T07:05:25+01:00","dateModified":"2021-07-30T07:05:25+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://nicolaiarocci.com/how-to-remove-a-file-from-git-history/"},"publisher":{"@type":"Organization","name":"Nicola Iarocci","logo":{"@type":"ImageObject","url":"https://nicolaiarocci.com/images/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://nicolaiarocci.com/ accesskey=h title="Nicola Iarocci (Alt + H)"><img src=https://nicolaiarocci.com/images/avatar.png alt aria-label=logo height=35>Nicola Iarocci</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://buttondown.email/nicolaiarocci title=subscribe><span>subscribe</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li><li><a href=https://nicolaiarocci.com/opensource/ title=code><span>code</span></a></li><li><a href=https://nicolaiarocci.com/speaking/ title=speaking><span>speaking</span></a></li><li><a href=https://nicolaiarocci.com/books-i-have-read/ title=library><span>library</span></a></li><li><a href=https://nicolaiarocci.com/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://nicolaiarocci.com/archives/ title=archive><span>archive</span></a></li><li><a href=https://nicolaiarocci.com/about/ title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">How to remove a file from Git history</h1><div class=post-meta><span title='2021-07-30 07:05:25 +0100 +0100'>July 30, 2021</span></div></header><div class=post-content><p>Today I learned how to remove a file from a git repository while also cleaning
it from the history. When you delete it with <code>git rm</code> or <code>git rm --cached</code>,
tracks remain in the commit history (the reflog). That might not be a big deal,
but if the file has sensitive contents that you want to disappear from version
control entirely, then you also want it cleaned from the reflog. That&rsquo;s when
<a href=https://git-scm.com/docs/git-filter-branch><code>git filter-branch</code></a> comes to the rescue.</p><p>To be on the safe side, I first cloned the repository to a test directory:</p><pre><code>$ git clone &lt;REPOSITORY&gt; test
$ cd test
</code></pre><p>Once into the test directory, this is the command that saved the day:</p><pre><code># make sure you insert the whole file path, relative to the repository root
$ git filter-branch --force --index-filter \
  &quot;git rm --cached --ignore-unmatch PATH-TO-THE-FILE&quot; \
  --prune-empty --tag-name-filter cat -- --all
</code></pre><p>The command above will go through the history, find all commits where the file
is involved, and alter them to eliminate the file. Yes, history changes,
so a force-push will be required at the end.</p><p>To test that the file has indeed been removed, I used <code>git blame</code>:</p><pre><code>$ git blame PATH-TO-THE-FILE
fatal: no such path 'PATH-TO-THE-FILE' in HEAD
</code></pre><p>If the file needs to stay in the local directory, you can add it to
<code>.gitignore</code>:</p><pre><code>$ echo &quot;PATH-TO-THE-FILE&quot; &gt;&gt; .gitignore
$ git add .gitignore
$ git commit -m &quot;add FILE to .gitignore&quot;
</code></pre><p>Once everything was ready, I went back to the original clone directory,
replayed all the above, then force-pushed back to the remote:</p><pre><code>$ git push origin --force --all
</code></pre><p>If you have remote tags, those need to be force-pushed as well:</p><pre><code>$ git push origin --force --tags
</code></pre><p>In my case, the repository is private with no forks, so the changing
history was not a big deal for the few colleagues with access to it. Of
course, any other existing clone will need to be updated<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p><p>In so many years with git, this is the very first time I had to do something
similar. Typically, you don&rsquo;t commit sensitive data to version control, but we
all make mistakes every once in a while, don&rsquo;t we?</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Keep in mind, eventual stashed changes will be lost after <code>git filter-branch</code>. Make sure you unstash before issuing the command.
[rss]: <a href=https://nicolaiarocci.com/index.xml>https://nicolaiarocci.com/index.xml</a>
[tw]: <a href=http://twitter.com/nicolaiarocci>http://twitter.com/nicolaiarocci</a>
[nl]: <a href=https://buttondown.email/nicolaiarocci>https://buttondown.email/nicolaiarocci</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://nicolaiarocci.com/tags/til/>Til</a></li><li><a href=https://nicolaiarocci.com/tags/git/>Git</a></li><li><a href=https://nicolaiarocci.com/tags/tools/>Tools</a></li></ul><nav class=paginav><a class=prev href=https://nicolaiarocci.com/finlands-intriguing-take-on-the-homelessness-problem/><span class=title>« Prev</span><br><span>Finland's intriguing take on the homelessness problem</span>
</a><a class=next href=https://nicolaiarocci.com/on-github-copilot/><span class=title>Next »</span><br><span>On GitHub Copilot</span></a></nav></footer></article></main><footer class=footer><span>Produced / Written / Maintained by <a href=/>Nicola Iarocci</a> since 2010</span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>